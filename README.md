# ç¾¤è®¨è®ºè‡ªåŠ¨æ€»ç»“å·¥å…·

è‡ªåŠ¨æ€»ç»“ç¾è‚¡å¾®ä¿¡ç¾¤ã€Discord ç¾¤è®¨è®ºå†…å®¹çš„å·¥å…·ï¼Œæ¯å¤©æ—©ä¸Šè‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Šã€‚

[![GitHub](https://img.shields.io/badge/GitHub-ä½¿ç”¨%20Git%20ç®¡ç†-blue)](https://github.com/ä½ çš„ç”¨æˆ·å/wechat-summary)
[![Python](https://img.shields.io/badge/Python-3.8+-blue)](https://www.python.org/)
[![Node.js](https://img.shields.io/badge/Node.js-16+-green)](https://nodejs.org/)

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ“Š è‡ªåŠ¨åˆ†æç¾¤æ¶ˆæ¯ï¼Œæå–è®¨è®ºä¸»é¢˜
- ğŸ’¬ è¯¦ç»†è®°å½•è®¨è®ºå†…å®¹å’Œç»“è®º
- ğŸ“ˆ è¯†åˆ«è®¨è®ºä¸­çš„ä¸ªè‚¡åŠè§‚ç‚¹
- ğŸ¤– åŸºäº LLM æ™ºèƒ½åˆ†æï¼ˆæ”¯æŒ GLM 4.7ã€DeepSeekã€OpenAIï¼‰
- ğŸ“… è‡ªåŠ¨æŒ‰æ—¶é—´ç­›é€‰ï¼ˆæ˜¨å¤© 00:00-23:59ï¼‰
- ğŸ¤– æ”¯æŒè·¨å¤©è®¨è®ºå¤„ç†
- ğŸ“ ç”Ÿæˆ Markdown æ ¼å¼æŠ¥å‘Š
- ğŸ”§ Mock æ¨¡å¼ç”¨äºå¼€å‘æµ‹è¯•
- ğŸ“¦ æ”¯æŒ Git ç‰ˆæœ¬ç®¡ç†

## æŠ€æœ¯æ ˆ

- **Python 3.8+**
- **Wechaty** - å¾®ä¿¡æœºå™¨äººæ¡†æ¶
- **OpenAI SDK** - LLM API å®¢æˆ·ç«¯
- **æ™ºè°± AI GLM** - æ¨èä½¿ç”¨ï¼ˆæ€§ä»·æ¯”é«˜ï¼‰
- **DeepSeek** - å¤‡é€‰æ–¹æ¡ˆ
- **OpenAI** - å¤‡é€‰æ–¹æ¡ˆ

## å®‰è£…æ­¥éª¤

### 1. å®‰è£…ä¾èµ–

```bash
cd wechat-summary
pip install --break-system-packages wechaty openai lxml
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` åˆ° `.env` å¹¶å¡«å†™é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# å¾®ä¿¡ç™»å½•é…ç½®ï¼ˆä» wechaty.io è·å–ï¼‰
WECHATY_TOKEN=your-wechaty-token-here

# LLM API é…ç½®ï¼ˆæ¨èä½¿ç”¨æ™ºè°± AI GLMï¼‰
# æ™ºè°± AIï¼šhttps://open.bigmodel.cn/
ZHIPU_API_KEY=your-zhipu-api-key-here
ZHIPU_BASE_URL=https://open.bigmodel.cn/api/paas/v4

# æˆ–ä½¿ç”¨ DeepSeek
# DEEPSEEK_API_KEY=your-deepseek-api-key-here
# DEEPSEEK_BASE_URL=https://api.deepseek.com

# ç¾¤èŠé…ç½®
TARGET_GROUPS=["ç¾è‚¡äº¤æµç¾¤1", "ç¾è‚¡ç­–ç•¥ç¾¤"]
GROUP_IDS=["7273788767", "1234567890"]
```

### 3. è·å–æ™ºè°± AI API Key

1. è®¿é—® [æ™ºè°± AI å¹³å°](https://open.bigmodel.cn/)
2. ä½¿ç”¨ GitHub ç™»å½•
3. è¿›å…¥ [API Keys é¡µé¢](https://open.bigmodel.cn/usercenter/apikeys)
4. åˆ›å»ºæ–°çš„ API Key
5. å¤åˆ¶ Key å¹¶å¡«å…¥ `.env` æ–‡ä»¶

### 4. è·å– Wechaty Token

1. è®¿é—® [wechaty.io](https://wechaty.io)
2. æ³¨å†Œå¹¶ç™»å½•
3. åœ¨è´¦å·è®¾ç½®ä¸­è·å– Token
4. å°† Token å¡«å…¥ `.env` æ–‡ä»¶

## ä½¿ç”¨æ–¹æ³•

### æ¯æ—¥è‡ªåŠ¨æ€»ç»“ï¼ˆæ¨èï¼‰

è®¾ç½® crontab å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ—©ä¸Š 9 ç‚¹è¿è¡Œï¼š

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆåœ¨æ¯å¤© 9 ç‚¹è¿è¡Œï¼‰
0 9 * * * cd /path/to/wechat-summary && python main_v2.py >> summary.log 2>&1
```

### æ‰‹åŠ¨è¿è¡Œ

#### åˆ†ææ˜¨å¤©çš„è®¨è®º

```bash
python main_v2.py
```

#### åˆ†ææŒ‡å®šæ—¥æœŸçš„è®¨è®º

```bash
python main_v2.py --date 2024-08-20
```

#### åˆ†æç‰¹å®šç¾¤èŠ

```bash
# é€šè¿‡ç¾¤åç§°
python main_v2.py --group "ç¾è‚¡äº¤æµç¾¤1"

# é€šè¿‡ç¾¤ ID
python main_v2.py --group "7273788767"
```

#### æµ‹è¯•æ¨¡å¼ï¼ˆä¸ä½¿ç”¨çœŸå® LLMï¼‰

```bash
python test_zhipu.py
```

## è¾“å‡ºç¤ºä¾‹

ç”Ÿæˆçš„æŠ¥å‘ŠåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

```markdown
# ç¾¤è®¨è®ºæ€»ç»“

**æ—¶é—´èŒƒå›´ï¼š** 2024-08-20 00:00 - 23:59
**æ€»ç»“æ—¥æœŸï¼š** 2024-08-21

## ğŸ“Š è®¨è®ºæ¦‚è§ˆ
å…±è®¨è®ºäº† 3 ä¸ªè¯é¢˜

## ğŸ“Œ è¯é¢˜ 1: è‹¹æœå…¬å¸è´¢æŠ¥è®¨è®º
### ğŸ’¬ è®¨è®ºå†…å®¹
å¤§å®¶å…³æ³¨ AAPL ä»Šå¤©çš„è‚¡ä»·è¡¨ç°ï¼Œæ–°å‘å¸ƒä¼šæ¶ˆæ¯å½±å“å¾ˆå¤§ï¼Œæœºæ„æ™®éçœ‹å¥½ Q4 è¡¨ç°ã€‚

### âœ… ç»“è®º
è‹¹æœè´¢æŠ¥å­£é¢„æœŸç§¯æï¼ŒiPhone 16 é”€é‡å€¼å¾—æœŸå¾…ã€‚

### ğŸ“ˆ å…·ä½“ä¸ªè‚¡
**è‹¹æœ AAPL**
- è‚¡ä»·é¢„æœŸä¸Šæ¶¨ï¼Œæœºæ„çœ‹å¥½ Q4 è¡¨ç°

**MSFT å¾®è½¯**
- Azure äº‘ä¸šåŠ¡å¢é•¿å¼ºåŠ²
- Copilot äº§å“æˆä¸ºæ–°å¢é•¿ç‚¹
```

## é…ç½®è¯´æ˜

### LLM API é…ç½®

æ”¯æŒä¸‰ç§ LLM APIï¼š

#### æ™ºè°± AI GLMï¼ˆæ¨èï¼‰â­â­â­â­â­

- ä¼˜ç‚¹ï¼šä¸­æ–‡æ”¯æŒå¥½ï¼Œæ€§ä»·æ¯”é«˜ï¼Œé€Ÿåº¦å¿«
- ä»·æ ¼ï¼šçº¦ 0.001 å…ƒ/åƒ token
- é…ç½®ï¼š`ZHIPU_API_KEY` å’Œ `ZHIPU_BASE_URL`

**è¯¦ç»†æŒ‡å—**ï¼š[ZHIPU_GUIDE.md](ZHIPU_GUIDE.md)

#### DeepSeekï¼ˆå¤‡é€‰ï¼‰â­â­â­â­â­

- ä¼˜ç‚¹ï¼šæ€§èƒ½ç¨³å®šï¼Œæ€§ä»·æ¯”é«˜
- ä»·æ ¼ï¼šçº¦ 0.001 å…ƒ/åƒ token
- é…ç½®ï¼š`DEEPSEEK_API_KEY` å’Œ `DEEPSEEK_BASE_URL`

#### OpenAIï¼ˆå¤‡é€‰ï¼‰â­â­â­

- ä¼˜ç‚¹ï¼šæ€§èƒ½ç¨³å®šï¼Œç”Ÿæ€å®Œå–„
- ä»·æ ¼ï¼šçº¦ 0.005 å…ƒ/åƒ token
- é…ç½®ï¼š`OPENAI_API_KEY`

### ç¾¤èŠé…ç½®

æ”¯æŒä¸¤ç§æ–¹å¼é…ç½®ç¾¤èŠï¼š

1. **ç¾¤åç§°åˆ—è¡¨**ï¼ˆæ¨èï¼‰ï¼š
   ```bash
   TARGET_GROUPS=["ç¾è‚¡äº¤æµç¾¤1", "ç¾è‚¡ç­–ç•¥ç¾¤", "ç¾è‚¡æŠ€æœ¯åˆ†æ"]
   ```

2. **ç¾¤ ID åˆ—è¡¨**ï¼ˆç²¾ç¡®ï¼‰ï¼š
   ```bash
   GROUP_IDS=["7273788767", "1234567890", "9876543210"]
   ```

### æ—¶é—´é…ç½®

é»˜è®¤æ€»ç»“æ˜¨å¤©çš„ 00:00-23:59ï¼š

```bash
SUMMARY_TIME="09:00"  # æ¯å¤©æ—©ä¸Š 9 ç‚¹æ‰§è¡Œ
TIMEZONE="Asia/Shanghai"  # æ—¶åŒºè®¾ç½®
```

## å·¥ä½œæµç¨‹

1. **ç™»å½•å¾®ä¿¡** â†’ æ‰«ç ç™»å½•ï¼Œå»ºç«‹è¿æ¥
2. **ç›‘å¬æ¶ˆæ¯** â†’ æŒç»­ç›‘å¬ç¾¤æ¶ˆæ¯
3. **æ—¶é—´ç­›é€‰** â†’ ç­›é€‰æŒ‡å®šæ—¶é—´èŒƒå›´çš„è®¨è®º
4. **LLM åˆ†æ** â†’ ä½¿ç”¨ LLM æå–ä¸»é¢˜ã€å†…å®¹ã€è‚¡ç¥¨ä¿¡æ¯
5. **ç”ŸæˆæŠ¥å‘Š** â†’ ç”Ÿæˆ Markdown æ ¼å¼æ€»ç»“
6. **ä¿å­˜/è¾“å‡º** â†’ ä¿å­˜åˆ°æ–‡ä»¶å¹¶æ‰“å°åˆ°æ§åˆ¶å°

## æˆæœ¬é¢„ä¼°

### æ™ºè°± AI GLM 4.7 Flashï¼ˆæ¨èï¼‰

- **ä»·æ ¼**ï¼šè¾“å…¥ 0.001 å…ƒ/åƒ tokenï¼Œè¾“å‡º 0.001 å…ƒ/åƒ token
- **æ¯å¤©ä½¿ç”¨é‡**ï¼šå‡è®¾ 100 æ¡æ¶ˆæ¯ï¼Œå¹³å‡ 500 tokens/æ¡
- **æ¯æ—¥æˆæœ¬**ï¼š
  - è¾“å…¥ï¼š100 Ã— 500 Ã— 0.001 = 0.05 å…ƒ
  - è¾“å‡ºï¼š100 Ã— 500 Ã— 0.001 = 0.05 å…ƒ
  - **åˆè®¡ï¼šçº¦ 0.10 å…ƒ/å¤©**

- **æ¯æœˆæˆæœ¬**ï¼š
  - 30 å¤© Ã— 0.10 å…ƒ = **çº¦ 3 å…ƒ/æœˆ**

### DeepSeek

- **ä»·æ ¼**ï¼šè¾“å…¥ 0.001 å…ƒ/åƒ tokenï¼Œè¾“å‡º 0.002 å…ƒ/åƒ token
- **æ¯å¤©æˆæœ¬**ï¼šçº¦ 0.15 å…ƒ
- **æ¯æœˆæˆæœ¬**ï¼šçº¦ 4.5 å…ƒ

### OpenAI

- **ä»·æ ¼**ï¼šè¾“å…¥ 0.005 å…ƒ/åƒ tokenï¼Œè¾“å‡º 0.015 å…ƒ/åƒ token
- **æ¯å¤©æˆæœ¬**ï¼šçº¦ 1.0 å…ƒ
- **æ¯æœˆæˆæœ¬**ï¼šçº¦ 30 å…ƒ

### è¶…å‡ºä¼°ç®—æƒ…å†µ

å¦‚æœæ¶ˆæ¯é‡æ›´å¤§ï¼š

- **æ¯å¤© 200 æ¡æ¶ˆæ¯ï¼Œæ¯æ¡ 800 tokens**

**æ™ºè°± AI GLM 4.7 Flash**ï¼š
- æ¯å¤©ï¼šçº¦ 0.20 å…ƒ
- æ¯æœˆï¼šçº¦ 6 å…ƒ

**OpenAI**ï¼š
- æ¯å¤©ï¼šçº¦ 2.0 å…ƒ
- æ¯æœˆï¼šçº¦ 60 å…ƒ

## å¸¸è§é—®é¢˜

### 1. å¾®ä¿¡ç™»å½•å¤±è´¥

- æ£€æŸ¥ Token æ˜¯å¦æ­£ç¡®
- ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
- å°è¯•é‡æ–°è·å– Token

### 2. æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯

- ç¡®ä¿ç¾¤èŠé…ç½®æ­£ç¡®
- æ£€æŸ¥å¾®ä¿¡æ˜¯å¦åœ¨è¿è¡Œ
- ç¡®è®¤ç¾¤èŠæƒé™

### 3. LLM åˆ†æå¤±è´¥

- æ£€æŸ¥ API Key æ˜¯å¦æœ‰æ•ˆ
- ç¡®è®¤ API é…é¢æ˜¯å¦å……è¶³
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### 4. Token é™åˆ¶

- å¦‚æœæ¶ˆæ¯é‡å¾ˆå¤§ï¼Œå¯ä»¥è°ƒæ•´ `max_tokens` å‚æ•°
- æˆ–è€…åˆ†æ‰¹åˆ†ææ¶ˆæ¯

## é«˜çº§é…ç½®

### è°ƒæ•´ LLM æ¨¡å‹

åœ¨ `llm_analyzer_v2.py` ä¸­ä¿®æ”¹ï¼š

```python
# GLM 4.7 Flashï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰
self.model = "glm-4.7-flash"

# GLM 4 Plusï¼ˆæ€§èƒ½æ›´å¼ºï¼Œæ›´è´µï¼‰
self.model = "glm-4-plus"

# GLM 4 Airï¼ˆæœ€ä¾¿å®œï¼‰
self.model = "glm-4-air"
```

### è°ƒæ•´æ¶ˆæ¯æ•°é‡é™åˆ¶

åœ¨ `llm_analyzer_v2.py` ä¸­è°ƒæ•´ï¼š

```python
for msg in filtered_messages[:500]:  # æœ€å¤šåˆ†æ 500 æ¡æ¶ˆæ¯
```

### è‡ªå®šä¹‰æŠ¥å‘Šæ ¼å¼

åœ¨ `report_generator.py` ä¸­ä¿®æ”¹ `_build_report` æ–¹æ³•

## æ•…éšœæ’æŸ¥

### æŸ¥çœ‹æ—¥å¿—

```bash
python main_v2.py 2>&1 | tee wechat-summary.log
```

### æµ‹è¯•é…ç½®

```bash
# æµ‹è¯•æ—¶é—´ç®¡ç†
python -c "from time_manager import TimeManager; print(TimeManager.get_yesterday_range())"

# æµ‹è¯•æ™ºè°± AI è¿æ¥
python test_zhipu.py
```

## æ–‡æ¡£ç´¢å¼•

- **README.md**ï¼ˆæœ¬æ–‡æ¡£ï¼‰- å®Œæ•´ä½¿ç”¨æ–‡æ¡£
- **QUICKSTART.md** - 5 åˆ†é’Ÿå¿«é€Ÿå…¥é—¨
- **SUMMARY.md** - é¡¹ç›®æ€»ç»“å’Œè´¹ç”¨é¢„ä¼°
- **ZHIPU_GUIDE.md** - æ™ºè°± AI GLM è¯¦ç»†æŒ‡å—

## è®¸å¯è¯

MIT License

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ–‡æ¡£æˆ–æäº¤ Issue æˆ–è”ç³»ç»´æŠ¤è€…ã€‚
